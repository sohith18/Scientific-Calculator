---
- name: Pull image and run container locally (no SSH)
  hosts: localhost
  connection: local
  become: true
  gather_facts: false
  collections:
    - community.docker

  vars:
    image_name: "sohith18/scientific-calculator:latest"
    container_name: "scientific-calculator"
    # Optionally override via --extra-vars:
    # host_port: "8080"
    # container_port: "8080"

  tasks:
    - name: Ensure Python Docker SDK is present
      ansible.builtin.pip:
        name: docker

    - name: Pull image
      community.docker.docker_image:
        name: "{{ image_name }}"
        source: pull

    - name: Ensure container is running
      community.docker.docker_container:
        name: "{{ container_name }}"
        image: "{{ image_name }}"
        state: started
        restart_policy: always
        pull: false
        ports: "{{ (host_port is defined and container_port is defined) | ternary([host_port ~ ':' ~ container_port], omit) }}"
        env:
          JAVA_TOOL_OPTIONS: "-XX:+UseContainerSupport"
